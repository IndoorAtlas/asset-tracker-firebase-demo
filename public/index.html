<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>IndoorAtlas Asset Tracker</title>

    <!-- update the version number as needed -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
    <script src="/__/firebase/4.10.1/firebase-app.js"></script>
    <script src="/__/firebase/4.10.1/firebase-auth.js"></script>
    <script src="/__/firebase/4.10.1/firebase-database.js"></script>
    <script src="/__/firebase/4.10.1/firebase-messaging.js"></script>

    <!-- Leave out Storage -->
    <!-- <script src="/__/firebase/4.10.1/firebase-storage.js"></script> -->

    <script src="/__/firebase/init.js"></script>
    <script src="custom-auth.js"></script>
    <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />
    <script src='https://api.mapbox.com/mapbox.js/v3.1.1/mapbox.js'></script>
    <link href='https://api.mapbox.com/mapbox.js/v3.1.1/mapbox.css' rel='stylesheet' />
    <script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.17.5/lodash.js"></script>
    <style>
      body { margin:0; padding:0; }
      #map { position:absolute; top:0; bottom:0; width:100%; }
    </style>
    </head>
    <body>

    <div id='map'></div>
    <script src="mapbox-access-token.js"></script>
    <script src="Leaflet.ImageOverlay.Rotated.js"></script>
    <script src="floorplan-view.js"></script>
    <script src="location-view.js"></script>
    <script>
      const map = L.mapbox.map('map', 'mapbox.light');

      const mainApp = {
        map: null,
        user: null,
        started: false,

        setMap(map) {
          console.log("map ready");
          this.map = map;
          this.checkStart();
        },
        setUser(user) {
          console.log("auth ready");
          this.user = user;
          this.checkStart();
        },
        checkStart() {
          if (!this.started && this.map && this.user) {
            this.started = true;
            runApp(this.map, this.user);
          }
        }
      };

      map.on('ready', function() {
        mainApp.setMap(map);
      });
    </script>
    <script src="main.js"></script>
    </body>
    </html>
</html>
