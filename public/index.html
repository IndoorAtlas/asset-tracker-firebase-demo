<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>IndoorAtlas Asset Tracker</title>

    <!-- update the version number as needed -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
    <script src="/__/firebase/4.10.1/firebase-app.js"></script>
    <script src="/__/firebase/4.10.1/firebase-auth.js"></script>
    <script src="/__/firebase/4.10.1/firebase-database.js"></script>
    <script src="/__/firebase/4.10.1/firebase-messaging.js"></script>

    <!-- Leave out Storage -->
    <!-- <script src="/__/firebase/4.10.1/firebase-storage.js"></script> -->

    <script src="/__/firebase/init.js"></script>
    <script src="custom-auth.js"></script>
    <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />
    <script src='https://api.mapbox.com/mapbox.js/v3.1.1/mapbox.js'></script>
    <link href='https://api.mapbox.com/mapbox.js/v3.1.1/mapbox.css' rel='stylesheet' />
    <script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.17.5/lodash.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/vue/2.5.16/vue.min.js"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <style>
      body { margin:0; padding:0; }
      #map { position:absolute; top:0; bottom:0; width:100%; }

      .asset-list {
        position:absolute;
        top: 10%;
        left: 5%;
        max-width: 30%;
        min-width: 400px;
      }

      .hidden {
        display: none;
      }
    </style>
    </head>
    <body>

    <div id='map'></div>
    <div id="vue-container" class="hidden">
      <div class="list-group asset-list" v-if="agents.length > 0">
        <a v-for="agent in agents" href="javascript:void(0)" class="list-group-item list-group-item-action flex-column align-items-start">
          <div class="d-flex w-100 justify-content-between">
            <h5 class="mb-1">{{ agent.agentId }}</h6>
            <small v-if="agent.venue">
              {{ agent.venue.name }}
              <span v-if="agent.floorPlan">, {{ agent.floorPlan.name }}</span>
            </small>
          </div>
        </a>
      </div>
    </div>
    <script src="mapbox-access-token.js"></script>
    <script src="Leaflet.ImageOverlay.Rotated.js"></script>
    <script src="floorplan-view.js"></script>
    <script src="location-view.js"></script>
    <script>
      const map = L.mapbox.map('map', 'mapbox.light');

      const mainApp = {
        map: null,
        user: null,
        started: false,

        setMap(map) {
          console.log("map ready");
          this.map = map;
          this.checkStart();
        },
        setUser(user) {
          console.log("auth ready");
          this.user = user;
          this.checkStart();
        },
        checkStart() {
          if (!this.started && this.map && this.user) {
            this.started = true;
            runApp(this.map, this.user, '#vue-container');
            $('#vue-container').removeClass('hidden');
          }
        }
      };

      map.on('ready', function() {
        mainApp.setMap(map);
      });
    </script>
    <script src="main.js"></script>
    </body>
    </html>
</html>
