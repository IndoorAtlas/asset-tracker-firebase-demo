<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>IndoorAtlas Asset Tracker</title>

    <!-- update the version number as needed -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
    <script src="/__/firebase/4.10.1/firebase-app.js"></script>
    <script src="/__/firebase/4.10.1/firebase-auth.js"></script>
    <script src="/__/firebase/4.10.1/firebase-database.js"></script>
    <script src="/__/firebase/4.10.1/firebase-messaging.js"></script>

    <!-- Leave out Storage -->
    <!-- <script src="/__/firebase/4.10.1/firebase-storage.js"></script> -->

    <script src="/__/firebase/init.js"></script>
    <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />
    <script src='https://api.mapbox.com/mapbox.js/v3.1.1/mapbox.js'></script>
    <link href='https://api.mapbox.com/mapbox.js/v3.1.1/mapbox.css' rel='stylesheet' />
    <script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.17.5/lodash.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vue@2.6.11"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"
      integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"
      integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css"
      integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous"/>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" crossorigin="anonymous"/>
    <link rel="stylesheet" href="style.css"/>
    </head>
    <body>

    <div id='map'></div>
    <svg version="1.1" id="indooratlas-svg-logo" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="100%" height="100%" viewBox="-1 -3.9 390 116.9" enable-background="new -1 -3.9 390 116.9" xml:space="preserve" fit="" preserveAspectRatio="xMidYMid meet" focusable="false">
    <g>

      <ellipse transform="matrix(-0.8657 -0.5006 0.5006 -0.8657 115.5141 78.7619)" cx="68.3" cy="23.9" rx="3.3" ry="1.8"></ellipse>
      <path d="M83.1,39c-2.6,4.6-12.6,3.8-22.2-1.8c-9.6-5.6-15.3-13.8-12.6-18.3c2-3.4,7.9-3.8,14.8-1.6
    	   c-7.9-2.8-15-2.3-17.3,1.8c-3,5.2,3.1,14.3,13.5,20.4c10.5,6.1,21.4,6.7,24.4,1.5c1.7-2.9,0.5-7.1-2.7-11.3
    	   C83.6,33.2,84.5,36.6,83.1,39z"></path>
      <path d="M74.6,23.4c-1.2-1-2.6-2-4.1-2.9c-1.7-1-3.4-1.7-5-2.2c-0.8-0.3-1.6-0.6-2.4-0.9c0.7,0.2,1.4,0.5,2.1,0.8
    	   c-4.3-1.4-8.1-1.1-9.3,1.1c-1.7,3,2,8.3,8.4,12c6.3,3.7,12.9,4.2,14.6,1.3c1.2-2.1-0.3-5.3-3.4-8.3c2.2,1.8,4.1,3.6,5.6,5.5
    	   C79.5,27.6,77.3,25.4,74.6,23.4z M76.6,30.4c-1.4,2.4-6.5,2-11.4-0.9c-4.9-2.8-7.8-7.1-6.4-9.4c1.4-2.4,6.5-2,11.4,0.9
    	   C75.1,23.8,78,28,76.6,30.4z"></path>
      <path d="M54.7,48.3c13.5,7.8,27.5,8.7,31.4,2c1-1.8,1.2-3.9,0.7-6.2l-0.1,0c0,1.3-0.3,2.5-1,3.6
    	   c-3.7,6.5-17.1,5.7-30-1.7c-3.9-2.3-7.3-4.9-10.1-7.6l-0.4-10.3L38.4,25c0-1.5,0.3-2.9,1-4.1c0.4-0.7,0.9-1.2,1.4-1.8l-0.2,0
    	   c-1.5,0.7-2.6,1.7-3.4,3.1c-0.4,0.6-0.6,1.3-0.8,1.9l-13.1-5.9l39.5-7.4v3.9c0,0,2.4,0.7,4.3,1.4c1.8,0.7,4.4,2,4.4,2l0.8-14.5
    	   L58.6,2.8L2.8,10.5l14.3,77l31.5,22.6l-0.8-22l21.1-9.6l0.2-1.8c0,0-4.6,1.6-9.5,2c-5,0.3-8.6-0.3-8.6-0.3l-3.6,1.4l-0.2-4.5
    	   c4.4,1.6,6.6,1.1,6.6,1.1s-2.4,0.1-6.6-1.5L47.1,72c13.9,6.2,21.8,2.2,21.8,2.2s-8.8,2.5-21.8-3.5l-0.2-5.2
    	   c13.8,7.5,27.7,8.4,31.4,1.9c0.4-0.6,0.6-1.3,0.8-2l0-0.1c-0.1,0.1-0.1,0.3-0.2,0.4c-3.8,6.6-18.1,5.6-32.1-2.3l-0.3-8
    	   c1,0.6,2,1.3,3,1.9c14.8,8.6,30.4,9.5,34.7,2c0.7-1.3,1.1-2.7,1.1-4.2l0-0.5c-0.2,1-0.5,1.9-0.9,2.7c-4.1,7.1-19.2,6.1-33.7-2.2
    	   c-1.5-0.9-2.9-1.8-4.3-2.7L45.8,42C48.4,44.3,51.4,46.4,54.7,48.3z"></path>
    </g>
    <g>
      <path d="M99.7,68.5v-36h7.9v36H99.7z"></path>
      <path d="M131.8,68.5V53.2c0-3.7-1.7-5.6-4.7-5.6c-3,0-4.8,1.9-4.8,5.6v15.2h-7.8V41.1h7.8V45c1.8-2.3,4.1-4.4,8-4.4
    	   c5.9,0,9.3,3.9,9.3,10.1v17.7L131.8,68.5L131.8,68.5z"></path>
      <path d="M165.3,68.5v-3.9c-1.9,2.6-4.5,4.4-8.5,4.4c-6.4,0-12.4-5-12.4-14.1v-0.1c0-9.1,6-14.1,12.4-14.1
    	   c4.1,0,6.7,1.9,8.5,4.1V32.5h7.8v36H165.3z M165.4,54.7c0-4.5-3-7.5-6.6-7.5c-3.6,0-6.7,3-6.7,7.5v0.1c0,4.5,3.1,7.5,6.7,7.5
    	   c3.6,0,6.6-3,6.6-7.5V54.7z"></path>
      <path d="M192.5,69.1c-8.5,0-14.7-6.3-14.7-14.1v-0.1c0-7.9,6.3-14.2,14.8-14.2c8.5,0,14.7,6.3,14.7,14.1v0.1
    	   C207.3,62.7,201,69.1,192.5,69.1z M199.7,54.8c0-4-2.9-7.5-7.2-7.5c-4.4,0-7.1,3.4-7.1,7.4v0.1c0,4,2.9,7.5,7.2,7.5
    	   c4.4,0,7.1-3.4,7.1-7.4V54.8z"></path>
      <path d="M225.2,69.1c-8.5,0-14.7-6.3-14.7-14.1v-0.1c0-7.9,6.3-14.2,14.8-14.2c8.5,0,14.7,6.3,14.7,14.1v0.1
    	   C240.1,62.7,233.8,69.1,225.2,69.1z M232.4,54.8c0-4-2.9-7.5-7.2-7.5c-4.4,0-7.1,3.4-7.1,7.4v0.1c0,4,2.9,7.5,7.2,7.5
    	   c4.4,0,7.1-3.4,7.1-7.4V54.8z"></path>
      <path d="M260.9,48.7c-5.1,0-8.3,3.1-8.3,9.6v10.1h-7.8V41.1h7.8v5.5c1.6-3.8,4.1-6.2,8.7-6v8.1L260.9,48.7
    	   L260.9,48.7z"></path>
      <path d="M290.1,68.5l-3.3-8h-15.1l-3.3,8h-8l15.3-36h7.2l15.3,36H290.1z M279.3,41.9l-4.7,11.6h9.5L279.3,41.9z"></path>
      <path d="M310,68.9c-4.7,0-8-1.9-8-8.2v-13h-3.3v-6.6h3.3v-6.3h7.8v6.3h6.4v6.6h-6.4v11.7c0,1.8,0.8,2.7,2.5,2.7
    	   c1.4,0,2.7-0.4,3.8-1v6.2C314.5,68.3,312.6,68.9,310,68.9z"></path>
      <path d="M321.8,68.5v-36h7.8v36H321.8z"></path>
      <path d="M351.9,68.5v-3c-1.9,2.1-4.5,3.5-8.3,3.5c-5.1,0-9.4-3-9.4-8.4v-0.1c0-6,4.5-8.7,11-8.7
    	   c2.8,0,4.7,0.5,6.7,1.1v-0.5c0-3.2-2-5-5.9-5c-3,0-5,0.6-7.5,1.5l-1.9-5.9c3-1.3,6-2.2,10.6-2.2c8.5,0,12.2,4.4,12.2,11.8v15.9
    	   L351.9,68.5L351.9,68.5z M352,57.4c-1.3-0.6-3.1-1-4.9-1c-3.3,0-5.4,1.3-5.4,3.8v0.1c0,2.1,1.7,3.3,4.2,3.3c3.6,0,6.1-2,6.1-4.8
    	   L352,57.4L352,57.4z"></path>
      <path d="M374.7,69c-3.8,0-8.1-1.3-11.7-4.1l3.3-5.1c3,2.1,6.1,3.3,8.6,3.3c2.2,0,3.3-0.8,3.3-2v-0.1
    	   c0-1.7-2.7-2.2-5.7-3.2c-3.8-1.1-8.2-2.9-8.2-8.2v-0.1c0-5.6,4.5-8.7,10-8.7c3.5,0,7.2,1.2,10.2,3.2l-3,5.4
    	   c-2.7-1.6-5.4-2.5-7.4-2.5c-1.9,0-2.9,0.8-2.9,1.9v0.1c0,1.5,2.6,2.2,5.6,3.3c3.8,1.3,8.3,3.1,8.3,8.1v0.1
    	   C385.2,66.2,380.7,69,374.7,69z"></path>
    </g>
    </svg>
    <div id="vue-container" class="hidden asset-list-window card accordion">
        <div id="device-list-header" class="card-header">
          <p class="mb-0 collapse-button collapsed" data-toggle="collapse" href="#device-list-collapse">
            <a class="asset-list-btn">
              Asset list
            </a>
          </p>
        </div>
        <div id="device-list-collapse" class="collapse" data-parent="#vue-container">
          <div class="list-group asset-list" v-if="agents.length > 0">
            <div
              v-for="agent in agents"
              v-on:click="activateAgent(agent.agentId)"
              v-bind:class='{ active: agent.agentId === activeAgent }'
              class="list-group-item list-group-item-action flex-column align-items-start">
              <div class="d-flex w-100 justify-content-between">
                <b class="mb-1">{{ agent.agentId }}</b>
                <small v-if="agent.venue || agent.floorPlan || agent.traceIdUrl">
                  <span v-if="agent.venue">{{ agent.venue.name }}</span>
                  <span v-if="agent.floorPlan">{{ agent.floorPlan.name }}</span>

                  <a
                    v-if="agent.traceIdUrl"
                    :href="agent.traceIdUrl"
                    target="_blank"
                    title="Show in Session Viewer"><i class="fa fa-external-link"></i></a>
                </small>
              </div>
            </div>
          </div>
        </div>
    </div>
    <script src="config.js"></script>
    <script src="Leaflet.ImageOverlay.Rotated.js"></script>
    <script src="floorplan-view.js"></script>
    <script>
      const map = L.mapbox.map('map', 'mapbox.light');

      const mainApp = {
        map: null,
        user: null,
        started: false,

        setMap(map) {
          console.log("map ready");
          this.map = map;
          this.checkStart();
        },
        setUser(user) {
          console.log("auth ready");
          this.user = user;
          this.checkStart();
        },
        checkStart() {
          if (!this.started && this.map && this.user) {
            this.started = true;
            runApp(this.map, this.user, '#vue-container');
            $('#vue-container').removeClass('hidden');
          }
        }
      };

      map.on('ready', function() {
        mainApp.setMap(map);
      });
    </script>
    <script src="custom-auth.js"></script>
    <script src="main.js"></script>
    </body>
    </html>
</html>
